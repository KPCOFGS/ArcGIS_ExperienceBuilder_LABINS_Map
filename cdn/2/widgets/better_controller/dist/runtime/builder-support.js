System.register(["jimu-core","jimu-ui","jimu-theme","jimu-for-builder","jimu-layouts/layout-runtime","jimu-ui/advanced/setting-components","jimu-layouts/layout-builder"],(function(e,t){var o={},a={},i={},l={},r={},n={},s={};return{setters:[function(e){o.AppMode=e.AppMode,o.BrowserSizeMode=e.BrowserSizeMode,o.ControllerPosition=e.ControllerPosition,o.ErrorBoundary=e.ErrorBoundary,o.Immutable=e.Immutable,o.LayoutItemType=e.LayoutItemType,o.React=e.React,o.ReactRedux=e.ReactRedux,o.WidgetManager=e.WidgetManager,o.WidgetState=e.WidgetState,o.WidgetType=e.WidgetType,o.appActions=e.appActions,o.classNames=e.classNames,o.css=e.css,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.jsx=e.jsx,o.lodash=e.lodash,o.polished=e.polished},function(e){a.Button=e.Button,a.Icon=e.Icon,a.Loading=e.Loading,a.NavButtonGroup=e.NavButtonGroup,a.Popper=e.Popper,a.Tooltip=e.Tooltip,a.defaultMessages=e.defaultMessages,a.getFallbackPlacementsModifier=e.getFallbackPlacementsModifier,a.utils=e.utils},function(e){i.getBuilderThemeVariables=e.getBuilderThemeVariables,i.getTheme2=e.getTheme2,i.styled=e.styled},function(e){l.appBuilderSync=e.appBuilderSync,l.getAppConfigAction=e.getAppConfigAction},function(e){r.LayoutContext=e.LayoutContext,r.PageContext=e.PageContext,r.searchUtils=e.searchUtils,r.utils=e.utils},function(e){n.WidgetListPopper=e.WidgetListPopper},function(e){s.CanvasPane=e.CanvasPane,s.DropArea=e.DropArea,s.addItemToLayout=e.addItemToLayout,s.withRnd=e.withRnd}],execute:function(){e((()=>{var e={9859:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M4 4h2v1H4zM8 4h2v1H8zM14 4h-2v1h2zM15 4h1v2h-1zM16 8h-1v2h1zM4 14h1v2H4zM5 6H4v2h1zM4 10h1v2H4zM16 12h-1v2h1zM16 15v1h-2v-1zM12 15h-2v1h2zM6 15h2v1H6z"></path><path fill="#000" fill-rule="evenodd" d="M18 0a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2zm0 1H2a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1" clip-rule="evenodd"></path></svg>'},2838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},9244:e=>{"use strict";e.exports=o},4108:e=>{"use strict";e.exports=l},6055:e=>{"use strict";e.exports=s},1496:e=>{"use strict";e.exports=r},1888:e=>{"use strict";e.exports=i},4321:e=>{"use strict";e.exports=a},9298:e=>{"use strict";e.exports=n}},t={};function c(o){var a=t[o];if(void 0!==a)return a.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,c),i.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var o in t)c.o(t,o)&&!c.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var d={};return(()=>{"use strict";c.r(d),c.d(d,{default:()=>X});var e=c(9244),t=c(4321);const o="controller",a={sm:24,default:32,lg:48},i=(e.ControllerPosition.TopRight,[{name:"preventOverflow",options:{boundary:document.body,rootBoundary:document}},{name:"offset",options:{offset:[0,16]}}]);var l=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(o[a[i]]=e[a[i]])}return o};const r=(e,t,o)=>{let i=a[e];return t&&(i+=21),i+=2*n(e,o),i},n=(e,t)=>"circle"===t?"sm"===e?4:"default"===e?2:"lg"===e?0:void 0:6,s=e.React.forwardRef(((o,a)=>{var i;const{label:s,className:c,title:d,showLabel:u,showIndicator:p=!0,showTooltip:g=!0,labelGrowth:v=0,icon:h,marker:f,onClick:m,onMarkerClick:y,avatar:b,autoFlip:w,active:R,editDraggable:S,disabled:x,widgetid:I}=o,C=l(o,["label","className","title","showLabel","showIndicator","showTooltip","labelGrowth","icon","marker","onClick","onMarkerClick","avatar","autoFlip","active","editDraggable","disabled","widgetid"]),k=b||{},{shape:j,style:O}=k,z=l(k,["shape","style"]),A=((t,o,a,i,l)=>e.React.useMemo((()=>{const s=r(t,o,i),c=s+l,d=n(t,i);return e.css`
      display: flex;
      align-items:center;
      flex-direction: column;
      justify-content: ${o?"space-around":"center"};
      width: ${e.polished.rem(c)} !important;
      height: ${e.polished.rem(s)};
      .tool-drag-handler {
        cursor: auto;
      }
      .avatar {
        padding: ${d}px;
        position: relative;
        text-align: center;
        &:hover .marker {
          visibility: visible;
        }
        .marker {
          position: absolute;
          right: 0;
          top: 0;
          padding: 0;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          .icon-btn-sizer {
            min-width: .625rem;
            min-height: .625rem;
          }
          visibility: hidden;
        }
      }
      ${a?".avatar.active {\n        .avatar-button, .marker {\n          transform: translateY(-7px);\n        }\n        .marker {\n          z-index: 1;\n        }\n        ::after {\n          content: '';\n          position: absolute;\n          bottom: 0;\n          left: 50%;\n          transform: translateX(-50%);\n          border: 1px solid var(--white);\n          border-radius: 3px;\n          width: 6px;\n          height: 3px;\n          background-color: var(--primary);\n          box-sizing: content-box;\n        }\n      }":""}
      .avatar-label {
        text-align: center;
        width: 100%;
        min-height: ${e.polished.rem(21)};
        cursor: default;
      }
    `}),[t,o,i,l,a]))(null==z?void 0:z.size,u,p,j,v),P=(0,e.jsx)(t.Button,Object.assign({"data-widgetid":I,icon:!0,active:R,className:(0,e.classNames)("avatar-button",{disabled:x}),ref:a},z,{style:Object.assign({borderRadius:"circle"===j?"50%":void 0},O),onClick:m}),(0,e.jsx)(t.Icon,{color:"string"!=typeof h&&(null===(i=h.properties)||void 0===i?void 0:i.color),icon:"string"!=typeof h?h.svg:h,autoFlip:w}));return(0,e.jsx)("div",Object.assign({},C,{className:(0,e.classNames)("avatar-card",`${c} avatar-card`),css:A}),(0,e.jsx)("div",{className:(0,e.classNames)({"no-drag-action":!S,active:R},"avatar tool-drag-handler")},f&&(0,e.jsx)(t.Button,{className:"marker",size:"sm",icon:!0,onClick:y},(0,e.jsx)(t.Icon,{size:8,icon:f})),g?(0,e.jsx)(t.Tooltip,{title:d||s,style:{pointerEvents:"none"}},P):P),u&&(0,e.jsx)("div",{className:(0,e.classNames)("avatar-label text-truncate",{active:R})},s))}));var u=c(2838),p=c.n(u);const g=(e,t,o)=>{let a=e,i=t;return i-a>o?i=e+o:i-a<o&&(a=0,i=a+o),[a,i]};const v=[],h=e.React.forwardRef(((o,a)=>{const{scrollRef:i,className:l,lists:r=v,createItem:n,vertical:s,itemLength:c,space:d,onChange:u,autoHideArrow:p,minLength:h=c,autoScrollEnd:f,autoSize:m,onScrollStatusChange:y}=o,b=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(o[a[i]]=e[a[i]])}return o}(o,["scrollRef","className","lists","createItem","vertical","itemLength","space","onChange","autoHideArrow","minLength","autoScrollEnd","autoSize","onScrollStatusChange"]),w=e.hooks.useTranslation(t.defaultMessages),[R,S]=e.hooks.useForwardRef(a),{start:x,end:I,disablePrevious:C,disableNext:k,hideArrow:j,scroll:O}=(t=>{var o;const{rootRef:a,lists:i,itemLength:l,autoSize:r,vertical:n,space:s,minLength:c,autoScrollEnd:d}=t,u=null!==(o=null==i?void 0:i.length)&&void 0!==o?o:0,p=((t,o,a=0,i=a,l)=>{let r=((t,o=500,a=!1,i)=>{var l,r;const n=a?"clientHeight":"clientWidth",[s,c]=e.React.useState(null!==(r=null===(l=t.current)||void 0===l?void 0:l[n])&&void 0!==r?r:0),d=!i&&!window.jimuConfig.isInBuilder,u=e.hooks.useLatest((()=>{const e=t.current[n]||0;c(e)})),p=e.React.useMemo((()=>e.lodash.debounce((()=>{u.current()}),o,{leading:!0})),[]);return e.React.useEffect((()=>{if(d)return;const e=t.current;e&&p();const o=new ResizeObserver(p);return o.observe(e),()=>{o.disconnect(),p.cancel()}}),[t,p,d]),s})(t,500,o,!l);r+=a,r=Math.max(r,i);const n=((t=500,o=!1)=>{const a=o?"clientHeight":"clientWidth",[i,l]=e.React.useState((()=>document.body[a]-40));e.hooks.useUpdateEffect((()=>{l(document.body[a]-40)}),[a]);const r=e.React.useMemo((()=>e.lodash.debounce((()=>{l(document.body[a]-40)}),t)),[a,t]);return e.React.useEffect((()=>(window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)})),[r]),i})(500,o);return r=l?n:Math.min(r,n),r})(a,n,s,c,r),v=Math.floor(p/l),[h,f]=e.React.useState(g(0,0,v)[0]),[m,y]=e.React.useState(g(0,0,v)[1]),b=e.hooks.useLatest(h),w=e.hooks.useLatest(m),R=m-h>=u,S=0===h,x=m===u;e.React.useEffect((()=>{if(0===p)return;const[e,t]=g(w.current,b.current,v);f(e),y(t)}),[v,p,w,b]);const I=e.hooks.useEventCallback(((e,t=!0)=>{const o=t?1:v;let a=0,i=0;e?(a=h-o,a<0?(a=0,i=a+v):i=m-o):(i=m+o,i>u?(i=u,a=i-v):a=h+o),f(a),y(i)})),C=e.React.useRef([]),k=e.hooks.useEventCallback((()=>{const e=u>0&&C.current.length>0&&i[i.length-1]!==C.current[C.current.length-1];if(d&&e&&C.current.length>u){let e=0,t=0;t=u,e=t-v,e=Math.max(0,e),f(e),y(t)}}));return e.React.useEffect((()=>{k(),C.current=i}),[i,k]),{start:h,end:m,disablePrevious:S,disableNext:x,hideArrow:R,scroll:I}})({rootRef:R,lists:r,itemLength:c,autoSize:m,vertical:s,space:d,minLength:h,autoScrollEnd:f}),z=r.slice(x,I),A=((t,o,a,i,l)=>e.css`
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    button.previous, button.next {
      flex-shrink: 0;
      display: ${l?"none":"block"};
    }
    .root {
      flex-direction: ${t?"column":"row"};
      width: 100%;
      height: 100%;
      min-width: ${e.polished.rem(a)};
      max-height: ${i?"100%":"calc(100% - 20px)"};
      max-width: ${i?"100%":"calc(100% - 20px)"};
      display: flex;
      justify-content: center;
      flex-wrap: nowrap;
      align-items: center;
      .scroll-list-item {
        &:not(:first-of-type) {
          margin-top: ${t?e.polished.rem(o):"unset"};
          margin-left: ${t?"unset":e.polished.rem(o)};
        }
      }
    }
`)(s,d,h,m,j);return e.React.useEffect((()=>{null==y||y(j,C,k)}),[k,C,j,y]),e.React.useEffect((()=>{t.utils.setRef(i,O)}),[O,i]),(0,e.jsx)(t.NavButtonGroup,Object.assign({},b,{css:A,type:"tertiary",vertical:s,onChange:e=>{null==u||u(e),O(e,!0)},disablePrevious:C,disableNext:k,previousAriaLabel:w("previous"),nextAriaLabel:w("next"),className:(0,e.classNames)("scroll-list",l)}),(0,e.jsx)("div",{className:"root scroll-list-root",ref:S},r.map((t=>{const o=!z.includes(t);return n(t,(0,e.classNames)("scroll-list-item",{"d-none":o}))}))))}));var f=c(9859),m=c.n(f),y=c(1888);const b=(0,y.styled)("div",{shouldForwardProp:e=>!["vertical","space"].includes(e)})`
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: ${e=>e.vertical?"column":"row"};
  .avatar-placeholder {
    &:not(:first-of-type) {
      margin-top: ${t=>t.vertical?e.polished.rem(t.space):"unset"};
      margin-left: ${t=>t.vertical?"unset":e.polished.rem(t.space)};
    }
  }
`,w=(e=>{const t=[];for(;e>0;)t.push(e),e--;return t})(3),R={type:"secondary",size:"lg",shape:"circle"},S=t=>{const{vertical:o,space:a,size:i="lg"}=t,l=e.React.useMemo((()=>Object.assign(Object.assign({},R),{size:i})),[i]);return e.React.createElement(b,{className:"list-placeholder",vertical:o,space:a},w.map(((t,o)=>e.React.createElement(s,{key:o,disabled:!0,className:"avatar-placeholder",icon:m(),label:"",showTooltip:!1,avatar:l}))))};function x(o){const{widgetId:a,canCrossLayoutBoundary:i,showMask:l,className:r,layoutId:n,layoutItemId:s}=o,c=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(o[a[i]]=e[a[i]])}return o}(o,["widgetId","canCrossLayoutBoundary","showMask","className","layoutId","layoutItemId"]),d=e.hooks.useCancelablePromiseMaker(),[u,p]=e.React.useState(null),[g,v]=e.React.useState(""),[h,f]=e.React.useState("");e.React.useEffect((()=>{p(null),v("");const t=d((t=>{var o,a;if(t)return(null===(a=null===(o=(0,e.getAppStore)().getState().widgetsRuntimeInfo)||void 0===o?void 0:o[t])||void 0===a?void 0:a.isClassLoaded)?Promise.resolve(e.WidgetManager.getInstance().getWidgetClass(t)):e.WidgetManager.getInstance().loadWidgetClass(t)})(a));t.then((e=>{p(e),v(a)}),(e=>{var t;f(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:e)}))}),[d,a]);const m=e.React.useCallback((()=>{var t,o;h||window.jimuConfig.isBuilder||(null===(o=null===(t=(0,e.getAppStore)().getState().widgetsRuntimeInfo)||void 0===t?void 0:t[a])||void 0===o?void 0:o.state)===e.WidgetState.Active||(0,e.getAppStore)().dispatch(e.appActions.activateWidget(a))}),[h,a]),y=(0,e.classNames)("widget-renderer w-100 h-100",r),b=(t=>e.React.useMemo((()=>e.css`
      overflow: ${t?"visible":"hidden"};
      position: relative;
      .widget-content {
        position: relative;
        height: 100%;
        width: 100%;
        z-index: 0;
      }
      .widget-mask {
        position: absolute;
        background: transparent;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: 1;
      }
  `),[t]))(i);return(0,e.jsx)("div",Object.assign({css:b,className:y,onMouseDownCapture:m,"data-widgetid":g},c),(0,e.jsx)("div",{className:"widget-content p-1"},h,!h&&u&&(0,e.jsx)(e.ErrorBoundary,null,(0,e.jsx)(u,{widgetId:g,layoutId:n,layoutItemId:s})),!h&&!u&&(0,e.jsx)(t.Loading,null)),l&&(0,e.jsx)("div",{className:"widget-mask"}))}const I=e.css`
  max-width: 100vw !important;
  /* hide rnd-resize bar for the outermost layout item */
  .controller-configuration-container > * > * > .builder-layout-item > .select-wrapper > .action-area {
      > .rnd-resize-top,
      > .rnd-resize-right,
      > .rnd-resize-bottom,
      > .rnd-resize-left {
        display: none;
      }
    }

    .controller-configuration-container .builder-layout-item > .select-wrapper > .lock-layout-tip {
      display: none;
    }

  .selectable {
    > div {
      cursor: default;
    }
  }

  .widget-container {
    height: 100%;
    overflow: auto;
  }
`,C={width:150,height:150},k={width:300,height:300},j=o=>{const{reference:a,placement:l,disableResize:r=!1,widgetId:n,controllerId:s,onClose:c,onSizeChange:d,size:u,version:p}=o,g=e.ReactRedux.useSelector((e=>{var t,o;return null===(o=null===(t=e.appConfig.widgets)||void 0===t?void 0:t[n])||void 0===o?void 0:o.label})),[v,h]=e.React.useState(!!n);e.hooks.useUpdateEffect((()=>{h(!1),setTimeout((()=>{h(!!n)}),0)}),[n]);const[f,m]=e.React.useState(""),[b,w]=e.React.useState(""),[R,S]=e.React.useState(null);e.React.useEffect((()=>{var t,o,a,i,l,r,c,d,u;const p=(0,e.getAppStore)().getState(),g=p.appConfig.widgets[n],v=p.browserSizeMode;let h=null!==(o=null===(t=null==g?void 0:g.parent)||void 0===t?void 0:t[v])&&void 0!==o?o:[];0===h.length&&(h=null!==(i=null===(a=null==g?void 0:g.parent)||void 0===a?void 0:a[p.appConfig.mainSizeMode])&&void 0!==i?i:[]);const f=p.appConfig.layouts,y=h.find((e=>{const t=e.layoutId;return f[t].parent.id===s})),b=null!==(l=null==y?void 0:y.layoutId)&&void 0!==l?l:"";m(b);const R=null!==(r=null==y?void 0:y.layoutItemId)&&void 0!==r?r:"";w(R);const x=null!==(d=null===(c=f[b])||void 0===c?void 0:c.content)&&void 0!==d?d:{};S(null!==(u=x[R])&&void 0!==u?u:null)}),[s,n]);const[j,O]=e.React.useState(null),z=e.React.useCallback((e=>{"hidden"!==e.style.visibility&&"none"!==e.style.display?j!==e&&O(e):O(null)}),[j]),A=((0,t.getFallbackPlacementsModifier)(["top-start","bottom-start"],!0).options.fallbackPlacements,(0,y.getTheme2)(),e.hooks.useTranslation(),e.ReactRedux.useSelector((t=>t.appRuntimeInfo.appMode===e.AppMode.Design))),P=e.ReactRedux.useSelector((e=>{var t,o,a;const i=e.appConfig.widgets[n];return null!==(a=null===(o=null===(t=null==i?void 0:i.manifest)||void 0===t?void 0:t.properties)||void 0===o?void 0:o.supportInlineEditing)&&void 0!==a&&a})),M=e.ReactRedux.useSelector((e=>{const t=e.widgetsRuntimeInfo[n];return P&&(null==t?void 0:t.isInlineEditing)})),E=e.ReactRedux.useSelector((t=>{var o;const a=t.appConfig.widgets[n];return(null===(o=null==a?void 0:a.manifest)||void 0===o?void 0:o.widgetType)!==e.WidgetType.Layout})),N=e.ReactRedux.useSelector((e=>{var t,o,a;const i=e.appConfig.widgets[n];return(null===(o=null===(t=null==i?void 0:i.manifest)||void 0===t?void 0:t.properties)||void 0===o?void 0:o.hasEmbeddedLayout)&&Object.keys(null!==(a=i.layouts)&&void 0!==a?a:{}).length>0})),L=A&&!M&&E&&!N,T=e.React.useCallback((t=>{t.stopPropagation(),P&&(0,e.getAppStore)().dispatch(e.appActions.setWidgetIsInlineEditingState(n,!0))}),[n,P]);return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.Popper,{modifiers:i,floating:!0,open:v,headerTitle:g,onHeaderClose:c,showHeaderCollapse:!0,minSize:C,onResizeStop:e=>{d(n,e)},dragBounds:"body",defaultSize:u||k,css:I,version:p,className:"flex-grow-1",reference:a,disableResize:r,toggle:e=>{if("Escape"===(null==e?void 0:e.key)){null==c||c();const e=null==a?void 0:a.querySelector("button");null==e||e.focus()}},placement:l,popperNodeRef:z,onClick:e=>{e.stopPropagation()},onDoubleClick:T},(0,e.jsx)("div",{className:"widget-container controller-configuration-container d-flex"},(0,e.jsx)(x,{widgetId:n,layoutId:f,layoutItemId:b,showMask:L}))))};var O=c(4108),z=c(1496);const A=(t,o)=>{const a=e.ReactRedux.useSelector((e=>e.widgetsRuntimeInfo)),i=P(t,o),l=N(i);return e.React.useMemo((()=>{const t={};return l.forEach((o=>{var i;const l=null!==(i=null==a?void 0:a[o])&&void 0!==i?i:{isClassLoaded:!1};t[o]=(0,e.Immutable)(l)})),(0,e.Immutable)(t)}),[l,a])},P=(t,o)=>e.ReactRedux.useSelector((e=>{var a,i,l,r;const n=null===(l=null===(i=null===(a=e.appConfig.widgets)||void 0===a?void 0:a[t])||void 0===i?void 0:i.layouts)||void 0===l?void 0:l[o],s=e.browserSizeMode,c=e.appConfig.mainSizeMode,d=z.searchUtils.findLayoutId(n,s,c);return null===(r=e.appConfig.layouts)||void 0===r?void 0:r[d]})),M=(t,o)=>{var a,i,l,r;const n=(0,e.getAppStore)().getState().appConfig,s=(0,e.getAppStore)().getState().browserSizeMode,c=null===(l=null===(i=null===(a=n.widgets)||void 0===a?void 0:a[t])||void 0===i?void 0:i.layouts)||void 0===l?void 0:l[o],d=z.searchUtils.findLayoutId(c,s,n.mainSizeMode);return null===(r=n.layouts)||void 0===r?void 0:r[d]},E=e=>{var t,o,a;let i=(null!==(a=null===(o=null===(t=null==e?void 0:e.order)||void 0===t?void 0:t.asMutable)||void 0===o?void 0:o.call(t))&&void 0!==a?a:[]).map((t=>{var o;return null===(o=e.content)||void 0===o?void 0:o[t]}));return i=i.filter((e=>e&&e.id&&e.widgetId&&!e.isPending)),i.map((e=>e.id))},N=e=>E(e).map((t=>{var o,a;return null===(a=null===(o=e.content)||void 0===o?void 0:o[t])||void 0===a?void 0:a.widgetId})),L=t=>[e.WidgetState.Opened,e.WidgetState.Active].includes(t.state);var T=c(9298),W=c(6055);const B=t=>{var o;const a=null==t?void 0:t.itemType,i=null===(o=null==t?void 0:t.manifest)||void 0===o?void 0:o.name;return a!==e.LayoutItemType.Section&&!["controller"].includes(i)&&!z.utils.isWidgetPlaceholder(z.utils.getAppConfig(),t)},$=(t,o,a)=>{const i={layoutId:t.id};let l=(0,O.getAppConfigAction)();(0,W.addItemToLayout)(l.appConfig,o,t.id).then((t=>{l=(0,O.getAppConfigAction)(t.updatedAppConfig),l.adjustOrderOfItem(t.layoutInfo,a||0),l.editLayoutItemProperty(t.layoutInfo,"bbox",{}),(0,e.getAppStore)().dispatch(e.appActions.layoutChanged(l.appConfig,i))}))};const D=e.React.forwardRef(((t,o)=>{const{widgetId:a,layout:i,layouts:l,vertical:r,childClass:n,placeholder:s,className:c}=t,d=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(o[a[i]]=e[a[i]])}return o}(t,["widgetId","layout","layouts","vertical","childClass","placeholder","className"]),{color:u,size:[p,g]}=s,v=e.React.useRef(null),h=e.React.useRef(null),f=e.React.useRef(null),m=e.React.useRef(null),y=e.React.useRef(null),[b,w]=e.React.useState(!1),R=e.hooks.useForkRef(v,o),S=e.css`
    width: 100%;
    height: 100%;
    position: absolute;
    left: 0;
    bottom: 0;
    top: 0;
    right: 0;
    background: transparent;
    z-index: ${b?1:0};
    > .drop-area {
      width: 100%;
      height: 100%;
    }
    > .overlay {
      position: absolute;
      left: 0;
      bottom: 0;
      top: 0;
      right: 0;
      background: transparent;
      z-index: -1;
      &.hide {
        display: none;
      }
    }
  `;return e.React.useEffect((()=>{h.current=new W.CanvasPane(y.current)}),[]),(0,e.jsx)("div",Object.assign({className:(0,e.classNames)("drop-zone",c),ref:R},d,{css:S}),(0,e.jsx)(W.DropArea,{style:S,className:"drop-area",layouts:l,highlightDragover:!0,onDragOver:(t,o,a,i,l,n)=>{let s=i;const c=m.current,d=v.current.offsetHeight,y=v.current.offsetWidth;if(c&&c.length)if(r){const{insertY:e,refId:t}=((e,t,o)=>{let a,i,l=!1;if(t.some(((e,r)=>{if(e.top+e.height/2>o){if(0===r)a=e.top;else{const o=t[r-1];a=(e.top+o.top+o.height)/2}l=!0,i=e.id}return l})),!l){const e=t[t.length-1];a=e.top+e.height}return{insertY:a,refId:i}})(0,c,n);f.current=t,s={top:e-g/2+v.current.scrollTop,width:p,left:(y-p)/2+v.current.scrollLeft,height:g}}else{const{insertX:e,refId:t}=((e,t,o)=>{let a,i,l=!1;if(t.some(((e,r)=>{if(e.left+e.width/2>o){if(0===r)a=e.left;else{const o=t[r-1];a=(e.left+o.left+o.width)/2}l=!0,i=e.id}return l})),!l){const e=t[t.length-1];a=e.left+e.width}return{insertX:a,refId:i}})(0,c,l);f.current=t,s={left:e-g/2+v.current.scrollLeft,width:g,top:(d-p)/2+v.current.scrollTop,height:p}}else s=r?{top:a.height/2-g/2,width:p,left:(y-p)/2+v.current.scrollLeft,height:g}:{left:a.width/2-g/2,width:g,top:(d-p)/2+v.current.scrollTop,height:p};h.current.clear(),h.current.setColor(e.polished.rgba(u,1)),h.current.drawRect(s)},onDrop:(e,t,o)=>{h.current.clear();let a=0;f.current?a=i.order&&i.order.indexOf(f.current)||0:i.order&&(a=i.order.length),$(i,e,a),f.current=null,m.current=[]},onToggleDragoverEffect:e=>{e&&(f.current=null,(()=>{m.current=[];const e=v.current.getBoundingClientRect(),t=v.current.parentNode.querySelectorAll(`.${n}`);t&&t.length&&t.forEach((t=>{const o=t.getAttribute("data-layoutitemid");if(i.order&&i.order.includes(o)){const a=z.utils.relativeClientRect(t.getBoundingClientRect(),e);a.id=o,m.current.push(a)}})),r?m.current.sort(((e,t)=>e.top-t.top)):m.current.sort(((e,t)=>e.left-t.left))})(),h.current.setSize(v.current.clientWidth,v.current.clientHeight)),w(e)}}),(0,e.jsx)("canvas",{className:(0,e.classNames)("overlay",{hide:!b}),ref:y}))})),H=(0,W.withRnd)(!1)((o=>{var a,i;const{markerEnabled:l,onMarkerClick:r,widgetid:n,showLabel:c,showIndicator:d,showTooltip:u,labelGrowth:g,avatar:v,onClick:h,active:f,editDraggable:m,className:y}=o,b=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.appConfig.widgets)||void 0===t?void 0:t[n]}));return b?e.React.createElement(s,{"data-widgetid":n,widgetid:n,className:`widget-avatar-card ${y}`,showLabel:c,showIndicator:d,showTooltip:u,labelGrowth:g,avatar:v,label:b.label,icon:b.icon,autoFlip:null===(i=null===(a=null==b?void 0:b.manifest)||void 0===a?void 0:a.properties)||void 0===i?void 0:i.flipIcon,marker:l?p():"",active:f,editDraggable:m,onMarkerClick:r,onClick:h}):e.React.createElement(t.Loading,null)})),F=t=>{const{className:o,draggable:a,layoutId:i,layoutItem:l,onClick:r,label:n,showLabel:s,showIndicator:c,showTooltip:d,labelGrowth:u,markerEnabled:p,avatar:g,active:v,removeWidget:h}=t;return e.React.createElement(H,{className:(0,e.classNames)(o,"layout-item","align-items-center"),layoutId:i,layoutItem:l,widgetid:l.widgetId,layoutItemId:l.id,label:n,markerEnabled:p,showLabel:s,showIndicator:c,showTooltip:d,labelGrowth:u,avatar:g,active:v,editDraggable:a,useDragHandler:!0,onClick:r,onMarkerClick:()=>{h(l.widgetId)}})};const G=e.React.forwardRef(((t,a)=>{const{widgetId:i,draggable:l,itemStyle:n,vertical:s,className:c,space:d,dropZoneRef:u,onItemClick:p,onClick:g,scrollRef:v,markerEnabled:f=!0,autoSize:m,placeholder:b,afterRemoveWidget:w}=t,R=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(o[a[i]]=e[a[i]])}return o}(t,["widgetId","draggable","itemStyle","vertical","className","space","dropZoneRef","onItemClick","onClick","scrollRef","markerEnabled","autoSize","placeholder","afterRemoveWidget"]),S=e.ReactRedux.useSelector((e=>{var t,a,l;return null===(l=null===(a=null===(t=e.appConfig.widgets)||void 0===t?void 0:t[i])||void 0===a?void 0:a.layouts)||void 0===l?void 0:l[o]})),x=P(i,o),I=E(x),C=(0,y.getBuilderThemeVariables)(),k=A(i,o),j=Object.keys(k).filter((e=>L(k[e]))),M=((e,t)=>{const o=null==e?void 0:e.showLabel,a=null==e?void 0:e.labelGrowth,i=null==e?void 0:e.avatar.size,l=null==e?void 0:e.avatar.shape;return r(i,o,l)+t+a})(n,d),N={color:null==C?void 0:C.colors.palette.primary[700],size:[M,5]};return e.React.createElement(z.LayoutContext.Provider,{value:{isItemAccepted:B}},e.React.createElement("div",{ref:a,className:(0,e.classNames)(c,"layout controller-layout w-100 h-100 d-flex align-items-center justify-content-center"),"data-layoutid":x.id,onClick:g},e.React.createElement(D,{widgetId:i,vertical:s,layout:x,childClass:`layout-${x.id}-item`,placeholder:N,layouts:S}),b||e.React.createElement(h,Object.assign({},R,{autoSize:m,scrollRef:v,className:"layout-item-list",vertical:s,itemLength:M,space:d,autoHideArrow:!0,lists:I,autoScrollEnd:!0,createItem:(t,o)=>{const a=x.content[t],i=a&&a.widgetId||"",r=j.includes(i);return e.React.createElement(F,Object.assign({},n,{key:t,className:(0,e.classNames)(`layout-${null==x?void 0:x.id}-item layout-item`,o),widgetid:i,layoutId:x.id,layoutItemId:t,draggable:l,markerEnabled:f,layoutItem:a,active:r,removeWidget:e=>{var o;o={layoutId:x.id,layoutItemId:t},O.appBuilderSync.publishConfirmDeleteToApp(o),w(e)},onClick:p}))}}))))}));const U=e.React.forwardRef(((t,o)=>{var a;const{showPlaceholder:i,itemStyle:l,space:r,vertical:n}=t,s=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(o[a[i]]=e[a[i]])}return o}(t,["showPlaceholder","itemStyle","space","vertical"]),c=n?r:l.labelGrowth;return e.React.createElement(G,Object.assign({className:"w-100 h-100",ref:o,itemStyle:l,space:r,vertical:n,placeholder:i?e.React.createElement(S,{size:null===(a=l.avatar)||void 0===a?void 0:a.size,space:c,vertical:n}):void 0},s))})),V=e.css`
  width: 300px;
  height: 300px;
  overflow-y: auto;
`,X={Builder:t=>{var a,i,l,r,n,s,c;const{id:d,config:u,version:p,autoSize:g}=t,v=e.hooks.useCheckSmallBrowserSizeMode(),h=null!==(i=null===(a=null==u?void 0:u.behavior)||void 0===a?void 0:a.arrangement)&&void 0!==i?i:"floating",f=null===(l=null==u?void 0:u.behavior)||void 0===l?void 0:l.vertical,m=null===(r=u.behavior)||void 0===r?void 0:r.size,y=f?"right-start":"bottom",{viewOnly:b}=e.React.useContext(z.PageContext),w=e.React.useRef(null),R=e.ReactRedux.useSelector((e=>e.widgetsState[d])),S=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.currentDialogId})),x=null==R?void 0:R.showWidgetsPanel,I=e.ReactRedux.useSelector((e=>e.browserSizeMode)),C=e.React.useRef(),k=A(d,o),P=!Object.keys(null!=k?k:{}).length,E=e.ReactRedux.useSelector((e=>e.appRuntimeInfo.selection)),[N,W]=e.React.useState(""),[D,H]=e.React.useState(""),[F,G]=e.React.useState("");e.React.useEffect((()=>{var t,o,a;if(E){const i=(0,e.getAppStore)().getState(),l=i.appConfig,r=Object.keys(k),n=i.browserSizeMode,s=i.appConfig.mainSizeMode;let c=z.searchUtils.findLayoutItem(l,E),d=E.asMutable();for(;c&&!r.includes(null==c?void 0:c.widgetId);)d=z.searchUtils.findParentLayoutInfo(d,l,n)||z.searchUtils.findParentLayoutInfo(d,l,s),c=z.searchUtils.findLayoutItem(l,d);W(null!==(t=null==c?void 0:c.widgetId)&&void 0!==t?t:""),H(null!==(o=null==d?void 0:d.layoutId)&&void 0!==o?o:""),G(null!==(a=null==d?void 0:d.layoutItemId)&&void 0!==a?a:"")}else W(""),H(""),G("")}),[E,k]),e.React.useEffect((()=>{const t=Object.keys(k).filter((e=>L(k[e])));(0,e.getAppStore)().dispatch(e.appActions.closeWidgets(t)),N&&(0,e.getAppStore)().dispatch(e.appActions.openWidget(N,d))}),[d,N]);const X=null===(n=w.current)||void 0===n?void 0:n.querySelector(`div.layout-item[data-layoutid="${D}"][data-layoutitemid="${F}"]`),Y=null==m?void 0:m[N],_="floating"===h||v;e.React.useEffect((()=>{I===e.BrowserSizeMode.Small&&void 0!==x&&O.appBuilderSync.publishSidePanelToApp({type:"widget",isPlaceholder:!1,isItemAccepted:B,onSelect:Q,keepPanel:!0,active:x})}),[x]);const q=e.React.useCallback(((t,o,a)=>{(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(d,"hideArrow",t)),(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(d,"disablePrevious",o)),(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(d,"disableNext",a))}),[d]);e.React.useEffect((()=>{(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(d,"onArrowClick",C.current))}),[d]);const Z=e.React.useCallback((()=>{(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(d,"showWidgetsPanel",!1))}),[d]);e.React.useEffect((()=>{S&&Z()}),[Z,S]);const J=e=>{(0,O.getAppConfigAction)().editWidgetConfig(d,e).exec()},K=e.React.useRef([0,0]),Q=e=>{var t,a;const i=M(d,o),l=null!==(a=null===(t=i.order)||void 0===t?void 0:t.length)&&void 0!==a?a:0;$(i,e,l)};return(0,e.jsx)("div",{className:"controller-builder w-100 h-100",ref:w,onClick:e=>{const t=e.target,o=w.current;t&&o&&o.contains(t)&&Z()}},N&&_&&(0,e.jsx)(j,{reference:X,version:p,disableResize:v,widgetId:N,controllerId:d,size:Y,onClose:()=>{var t,o;const a=(0,e.getAppStore)().getState(),i=a.appConfig,l=a.browserSizeMode,r=i.widgets[d].parent;let n=null!==(t=r[l])&&void 0!==t?t:[];0===n.length&&(n=null!==(o=r[i.mainSizeMode])&&void 0!==o?o:[]),n.length>0?(0,e.getAppStore)().dispatch(e.appActions.selectionChanged(n[0])):(0,e.getAppStore)().dispatch(e.appActions.selectionChanged(null))},onSizeChange:(t,o)=>{if(!t)return;let a=(null==u?void 0:u.behavior.size)||(0,e.Immutable)({});a=a.set(t,o),J(u.setIn(["behavior","size"],a))},placement:y}),(0,e.jsx)(U,{autoSize:g,scrollRef:C,showPlaceholder:P,onScrollStatusChange:q,vertical:null===(s=null==u?void 0:u.behavior)||void 0===s?void 0:s.vertical,widgetId:d,onItemClick:t=>{var a;if(b)return;const i=null===(a=t.currentTarget.dataset)||void 0===a?void 0:a.widgetid,l=K.current[0]!==t.clientX||K.current[1]!==t.clientY;if(i&&!l){t.stopPropagation();const a=M(d,o),l=Object.keys(a.content).find((e=>a.content[e].widgetId===i));(0,e.getAppStore)().dispatch(e.appActions.selectionChanged({layoutId:a.id,layoutItemId:l}))}},onMouseDown:e=>{K.current=[e.clientX,e.clientY]},itemStyle:u.appearance.card,draggable:!0,markerEnabled:!b,space:null===(c=null==u?void 0:u.appearance)||void 0===c?void 0:c.space,afterRemoveWidget:e=>{u.behavior.openStarts.includes(e)&&J(u.setIn(["behavior","openStarts"],u.behavior.openStarts.filter((t=>t!==e))))}}),x&&I!==e.BrowserSizeMode.Small&&(0,e.jsx)(T.WidgetListPopper,{css:V,placement:"right-start",referenceElement:w.current,isAccepted:B,onSelect:Q,onClose:e=>{(e=>{var t,o;if(!e)return!1;if("controller-add-widget"===(null===(t=e.dataset)||void 0===t?void 0:t.extname))return!0;const a=e.parentElement;return"controller-add-widget"===(null===(o=null==a?void 0:a.dataset)||void 0===o?void 0:o.extname)})(null==e?void 0:e.target)||Z()}}))}}})(),d})())}}}));