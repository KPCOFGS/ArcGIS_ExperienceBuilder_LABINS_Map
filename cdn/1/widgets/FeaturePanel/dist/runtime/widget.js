System.register(["jimu-core","jimu-ui","jimu-arcgis","esri/widgets/Feature","esri/core/Handles","esri/widgets/Popup"],(function(e,t){var s={},i={},a={},r={},o={},n={};return{setters:[function(e){s.React=e.React,s.appActions=e.appActions,s.css=e.css,s.getAppStore=e.getAppStore,s.jsx=e.jsx},function(e){i.WidgetPlaceholder=e.WidgetPlaceholder},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent},function(e){r.default=e.default},function(e){o.default=e.default},function(e){n.default=e.default}],execute:function(){e((()=>{var e={2939:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 50 50"><path fill="#231F20" d="M45.915 0H4.085C1.829 0 0 1.913 0 4.271v31.047c0 2.359 1.829 4.271 4.085 4.271h16.58l-2.956 10.512.156-.151L28.66 39.591h17.255c2.256 0 4.085-1.911 4.085-4.271V4.271C50 1.913 48.171 0 45.915 0z"></path></svg>'},4258:e=>{"use strict";e.exports=o},5894:e=>{"use strict";e.exports=r},8405:e=>{"use strict";e.exports=n},6826:e=>{"use strict";e.exports=a},8891:e=>{"use strict";e.exports=s},726:e=>{"use strict";e.exports=i}},t={};function d(s){var i=t[s];if(void 0!==i)return i.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,d),a.exports}d.d=(e,t)=>{for(var s in t)d.o(t,s)&&!d.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="";var l={};return d.p=window.jimuConfig.baseUrl,(()=>{"use strict";d.r(l),d.d(l,{__set_webpack_public_path__:()=>u,default:()=>h});var e=d(8891),t=d(726);function s(t,s){const i=t.surfaces[1].bg;return e.css`
    overflow: auto;
    .widget-feature,
    .widget-feature-div {
      width: 100%;
      height: 100%;
      background-color: ${i};
    }
    .featureheader {
      text-align: center;
      height: 30px;
      border-bottom: solid 1px #ccc;
      -moz-user-select: none;
      -webkit-user-select: none;
      -ms-user-select:none;
      user-select:none;
      -o-user-select:none;
    }
    .widget-feature-main-container>.container {
      margin-bottom: 4px;
    }
  `}const i="Select feature(s) in the map";var a=d(6826),r=d(5894),o=d(4258),n=d(8405);const p=d(2939);class c extends e.React.PureComponent{constructor(t){var s;if(super(t),this.myRef=e.React.createRef(),this.handles=new o.default,this.handleOpenSidebar=()=>{this.sidebarVisible||((0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(this.getActiveSidebarId(),"collapse",!0)),this.sidebarVisible=!0)},this.handleCloseSidebar=()=>{this.sidebarVisible&&((0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(this.getActiveSidebarId(),"collapse",!1)),this.sidebarVisible=!1)},this.activeViewChangeHandler=e=>{null!=e?(this.setState({jimuMapView:e}),this.resetFeaturePanelContents(),e.whenJimuMapViewLoaded().then((()=>{var t;e.view.popup=new n.default,e.view.popupEnabled=!1,null===(t=this.mapClickEventHandler)||void 0===t||t.remove(),this.addViewListener()}))):this.setState({jimuMapView:null})},this.addViewListener=()=>{const{view:e}=this.state.jimuMapView;this.mapClickEventHandler=e.on("click",(t=>{t.stopPropagation(),this.handles.removeAll(),this.clickHasResults=!1,this.myRef.current.innerHTML="",e.popup.fetchFeatures(t).then((t=>{this.setState({totalNumOfLayers:t.promisesPerLayerView.length-1}),t.promisesPerLayerView.forEach((t=>{const s=t.layerView;t.promise.then((t=>{if(t.length>0){const i=document.createElement("div");i.className="container pb-2 border-bottom"+(i.children.length>0||this.myRef.current.children.length>0?" pt-2":"");const a=document.createElement("h3");a.innerHTML=s.layer.title+(t.length>1?" ("+t.length+")":""),i.appendChild(a),this.myRef.current.appendChild(i),t.forEach((t=>{"function"==typeof s.highlight&&this.handles.add(s.highlight(t));let a=new r.default({container:document.createElement("div"),graphic:t,map:e.map,spatialReference:e.spatialReference}).container;a.classList.add("pb-3"),i.appendChild(a),this.clickHasResults=!0})),this.props.config.autoOpenClose&&this.doesSidebarHaveFP()&&this.sidebarWidgetsArray.length>0&&this.clickHasResults&&this.handleOpenSidebar()}this.setState({totalNumOfLayers:this.state.totalNumOfLayers-1},(()=>{this.state.totalNumOfLayers<0&&!this.clickHasResults&&this.resetFeaturePanelContents(),this.state.totalNumOfLayers<0&&this.clickHasResults&&this.myRef.current.lastChild.classList.remove("border-bottom"),this.props.config.autoOpenClose&&this.doesSidebarHaveFP()&&this.state.totalNumOfLayers<0&&!this.clickHasResults&&this.sidebarWidgetsArray.length>0&&this.handleCloseSidebar()}))}))}))}))}))},this.resetFeaturePanelContents=()=>{if(this.myRef.current){this.myRef.current.innerHTML="";const e=document.createElement("div");e.className="featureheader";const t=document.createElement("div");t.className="instructions",t.innerHTML=this.props.intl.formatMessage({id:"selectfeatures",defaultMessage:i}),e.appendChild(t),this.myRef.current.appendChild(e)}},this.getActiveSidebarId=()=>{let e="";return this.sidebarWidgetsArray.some((t=>{if(Object.keys(t.layouts.FIRST)[0]===this.props.browserSizeMode)return e=t.id,!0})),e},this.doesSidebarHaveFP=()=>{let t=!1;const s=(0,e.getAppStore)().getState().appConfig;let i,a;return this.sidebarWidgetsArray&&this.sidebarWidgetsArray.some((e=>{if(Object.keys(e.layouts.FIRST)[0]===this.props.browserSizeMode){i=e.layouts.FIRST[this.props.browserSizeMode],a=e.layouts.SECOND[this.props.browserSizeMode];let r=Object.keys(s.layouts[i].content),o=Object.keys(s.layouts[a].content);return r.some((e=>{if(s.layouts[i].content[e].widgetId===this.props.id)return t=!0,!0})),o.some((e=>{if(s.layouts[a].content[e].widgetId===this.props.id)return t=!0,!0})),!0}})),t},this.state={jimuMapView:null,totalNumOfLayers:0},(0,e.getAppStore)().getState().appConfig.widgets&&(this.widgetsArray=Object.values((0,e.getAppStore)().getState().appConfig.widgets),this.sidebarWidgetsArray=this.widgetsArray.filter((e=>"widgets/layout/sidebar/"===e.uri))),this.props.config.autoOpenClose&&this.doesSidebarHaveFP()&&this.sidebarWidgetsArray.length>0){const t=this.getActiveSidebarId();this.sidebarVisible=(null===(s=(0,e.getAppStore)().getState().widgetsState[t])||void 0===s?void 0:s.collapse)||!1,(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(t,"collapse",!this.sidebarVisible)),this.sidebarVisible=!this.sidebarVisible}}componentWillUnmount(){var e;null===(e=this.mapClickEventHandler)||void 0===e||e.remove()}componentDidUpdate(){var t;if(this.props.config.autoOpenClose&&this.doesSidebarHaveFP()){const s=this.getActiveSidebarId();this.sidebarVisible=null===(t=(0,e.getAppStore)().getState().widgetsState[s])||void 0===t?void 0:t.collapse}}render(){var r;let o=null;const n=this.props.useMapWidgetIds&&this.props.useMapWidgetIds[0],{config:d}=this.props;return o=n?(0,e.jsx)("div",{className:"widget-feature-div"},n&&(0,e.jsx)(a.JimuMapViewComponent,{useMapWidgetId:null===(r=this.props.useMapWidgetIds)||void 0===r?void 0:r[0],onActiveViewChange:this.activeViewChangeHandler}),(0,e.jsx)("div",{ref:this.myRef,className:"p-2",id:"widget-feature-main-container"},(0,e.jsx)("div",{className:"featureheader"},(0,e.jsx)("div",{className:"instructions"},this.props.intl.formatMessage({id:"selectfeatures",defaultMessage:i}))))):(0,e.jsx)("div",{className:"widget-feature-div"},(0,e.jsx)(t.WidgetPlaceholder,{icon:p,autoFlip:!0,message:this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:"Feature Panel"}),widgetId:this.props.id})),(0,e.jsx)("div",{className:"widget-feature jimu-widget",css:s(this.props.theme)},o)}}c.mapExtraStateProps=(e,t)=>(e&&e.appConfig,e&&e.browserSizeMode,{browserSizeMode:e&&e.browserSizeMode});const h=c;function u(e){d.p=e}})(),l})())}}}));